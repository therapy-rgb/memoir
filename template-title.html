<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>◊(select-from-metas 'title here)</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body class="title-page">
  <main>
    ◊(->html doc)
  </main>
  <nav class="toc">
    ◊(let loop ([node here] [front ""] [prose-buf ""] [poems-buf ""] [back ""])
      (define nxt (next node))
      (if nxt
        (let ([title (select-from-metas 'title nxt)]
              [section (or (select-from-metas 'section nxt) "")])
          (define entry (format "<a class=\"toc-entry~a\" href=\"~a\">~a</a>\n"
                          (if (string=? section "poems") " toc-poem" "") nxt title))
          (cond
            [(string=? section "prose")
             (loop nxt front (string-append prose-buf entry) poems-buf back)]
            [(string=? section "poems")
             (loop nxt front prose-buf (string-append poems-buf entry) back)]
            ;; Before prose starts, it's a front-matter entry
            [(string=? prose-buf "")
             (loop nxt (string-append front entry) prose-buf poems-buf back)]
            ;; After poems, it's back-matter
            [else
             (loop nxt front prose-buf poems-buf (string-append back entry))]))
        ;; Assemble: front entries, then prose section, then poems section, then back entries
        (string-append
          front
          (if (> (string-length prose-buf) 0)
            (format "<details class=\"toc-section\">\n<summary class=\"toc-section-heading\">Section 1</summary>\n~a</details>\n" prose-buf)
            "")
          (if (> (string-length poems-buf) 0)
            (format "<details class=\"toc-section\">\n<summary class=\"toc-section-heading\">Poems</summary>\n~a</details>\n" poems-buf)
            "")
          back)))
  </nav>
</body>
</html>
